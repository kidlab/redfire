<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns="*" width="100%" height="100%"
	paddingTop="8" paddingLeft="8" paddingRight="8" paddingBottom="8" verticalGap="12">

	<mx:Script>
		<![CDATA[

			import com.salesbuilder.control.TabManager;
			import com.salesbuilder.view.OpportunityPanel;
			import com.salesbuilder.model.Opportunity;
			import com.salesbuilder.model.Account;
			import mx.controls.dataGridClasses.DataGridColumn;

			[Bindable] public var account:Account;

			private function openOpportunity():void
			{
				var opportunity:Opportunity = dgOpportunities.selectedItem as Opportunity;
				opportunity.account = account;
				TabManager.openOpportunity(opportunity);
			}

			private function addOpportunity():void
			{
				var tab:OpportunityPanel = TabManager.openTab(OpportunityPanel) as OpportunityPanel;	
				tab.opportunity = new Opportunity(); 
				tab.opportunity.account = account;
			}
			
			private function currencyFormat(item:Object, column:DataGridColumn):String
			{
				return String(item[column.dataField]);
			}

			private function percentFormat(item:Object, column:DataGridColumn):String
			{
				return item[column.dataField];
			}
			
			private function dgDateFormat(item:Object, column:DataGridColumn):String
			{
				return String(new Date(item[column.dataField]));
			}
					

		]]>
	</mx:Script>

	<mx:CurrencyFormatter id="cf"/>
    	<mx:DateFormatter id="df"/>

	<mx:DataGrid id="dgOpportunities" dataProvider="{account.opportunities}" width="100%" height="100%" doubleClickEnabled="true" 
		doubleClick="openOpportunity()">
		<mx:columns>
			<mx:DataGridColumn dataField="name" headerText="Transaction"/>
			<mx:DataGridColumn dataField="expectedAmount" labelFunction="currencyFormat" headerText="Total Amount" textAlign="right"/>
			<mx:DataGridColumn dataField="probability" headerText="Transfer Fee" labelFunction="percentFormat" textAlign="right"/>
			<mx:DataGridColumn dataField="expectedCloseDate" headerText="Date" labelFunction="dgDateFormat"/>			
		</mx:columns>
	</mx:DataGrid>

	<mx:HBox width="100%">
		<mx:Button label="New Transfer" icon="@Embed('/assets/icon_plus.png')" click="addOpportunity()" paddingLeft="8" enabled="{account.accountId>0}"/>
	</mx:HBox>

</mx:VBox>