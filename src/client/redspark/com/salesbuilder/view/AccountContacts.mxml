<?xml version="1.0" encoding="utf-8"?>
<mx:VBox xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:v="com.salesbuilder.view.*" width="100%" height="100%"
	paddingTop="8" paddingLeft="8" paddingRight="8" paddingBottom="8" verticalGap="12">

	<mx:Script>
		<![CDATA[

			import mx.core.Application;
			import com.salesbuilder.model.Contact;
			import com.salesbuilder.control.TabManager;
			import com.salesbuilder.view.ContactPanel;
			import com.salesbuilder.model.Account;
			import mx.managers.PopUpManager;

			[Bindable] public var account:Account;

			private function openContact():void
			{
				var contact:Contact = dgContacts.selectedItem as Contact;
				contact.account = account;
				TabManager.openContact(contact);
			}

			private function addContact():void
			{
				var tab:ContactPanel = TabManager.openTab(ContactPanel) as ContactPanel;	
				tab.contact = new Contact();
				tab.contact.account = account;
			}

			private function addQuickContact():void
			{
				var popup:QuickContact = PopUpManager.createPopUp(Application.application as DisplayObject, QuickContact, false) as QuickContact;
				PopUpManager.centerPopUp(popup);
				popup.contact.account = account;
			}
			
		]]>
	</mx:Script>

	<mx:ViewStack id="vs" width="100%" height="100%" creationPolicy="all">
		<v:OrgChartView id="orgChart" contacts="{account.contacts}" account="{account}" width="100%" height="100%" icon="@Embed('/assets/icon_orgchart.png')"/>
		<mx:Canvas width="100%" height="100%" icon="@Embed('/assets/icon_grid.png')">
			<mx:DataGrid id="dgContacts" dataProvider="{account.contacts}" width="100%" height="100%" doubleClickEnabled="true" 
				doubleClick="openContact()">
				<mx:columns>
					<mx:DataGridColumn dataField="firstName" headerText="First Name"/>
					<mx:DataGridColumn dataField="lastName" headerText="Last Name"/>
					<mx:DataGridColumn dataField="title" headerText="Title"/>
					<mx:DataGridColumn dataField="phone" headerText="Phone"/>
				</mx:columns>
			</mx:DataGrid>
		</mx:Canvas>
	</mx:ViewStack>

	<mx:HBox width="100%">
		<mx:ButtonBar dataProvider="{vs}" styleName="mainButtonBar"/>
		<mx:Spacer width="100%"/>
		<mx:Button label="New Contact" icon="@Embed('/assets/icon_plus.png')" click="addContact()" paddingLeft="8" enabled="{account.accountId>0}"/>
		<mx:Button label="Quick Contact" icon="@Embed('/assets/icon_plus.png')" click="addQuickContact()" paddingLeft="8" enabled="{account.accountId>0}"/>
	</mx:HBox>

</mx:VBox>