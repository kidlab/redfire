<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" xmlns:c="com.salesbuilder.controls.*" xmlns:r="com.Rating.*"
	width="100%" height="100%" 
	label="General"
	creationComplete="initComp()">

	<mx:Script>
		<![CDATA[

		import com.salesbuilder.control.TabManager;
		import com.salesbuilder.control.Params;
		import com.salesbuilder.model.Account;
		import com.salesbuilder.dao.AccountDAO;
		import mx.core.Container;

		[Bindable] public var account:Account;
		
		private function initComp():void 
		{
			industry.dataProvider = Params.instance.industries;
			accountOwner.dataProvider = Params.instance.owners;
			addressState.dataProvider = Params.instance.states;
		}
		
		private function save(close:Boolean = false):void
		{
			account.name = this.accountName.text;
			account.industry = industry.value as int;
			account.owner = accountOwner.value as int;
			account.phone = phone.text;
			account.fax = fax.text;
			account.email = email.text;
			account.ownership = ownership.text;
			account.numberEmployees = Number(numEmployees.text);
			account.annualRevenue = Number(revenue.text);
			account.priority = priority.value;
			account.rating = rating.value;
			account.address1 = address1.text;
			account.address2 = address2.text;
			account.city = city.text;
			account.state = addressState.value as String;
			account.zip = zip.text;
			account.url = url.text;
			account.lastUpdated = new Date().time;
			
			var panel:Container = parent.parent as Container;
			panel.label = account.name;
			var dao:AccountDAO = new AccountDAO();
			if (account.accountId>0)
			{
				 // Check if we aren't updating an account that has been created offline
				 // and not yet sent to the server
				if (account.offlineOperation != "INSERT")
				{
					account.offlineOperation = "UPDATE";
				}
				dao.updateAccount(account);
			}
			else
			{
				account.offlineOperation = "INSERT";
				dao.createAccount(account,
					function ():void
					{
						TabManager.setUniqueTab("ACCOUNT:"+account.accountId, panel);
					});
			}
			if (close) TabManager.removeTab(panel);
		}
			
		]]>
	</mx:Script>

	<mx:Label x="10" y="16" text="General Information" styleName="title"/>

	<mx:Label y="55" width="116" text="Customer Name" textAlign="right" x="18"/>
	<c:TextInput y="50" id="accountName" text="{account.name}" width="190" x="154"/>
	<mx:Label y="125" width="116" text="Industry" textAlign="right" x="18"/>
	<c:ComboBox y="120" id="industry" value="{account.industry}" width="190" x="154"/>
	<mx:Label y="160" width="116" text="Owner" textAlign="right" x="18"/>
	<c:ComboBox y="155" id="accountOwner" value="{account.owner}" width="190" x="154"/>
	<mx:Label y="195" width="116" text="Customer Id" textAlign="right" x="18"/>
	<c:TextInput y="190" id="accountId" width="190" text="{account.accountId}" enabled="false" x="154"/>

	<mx:Label y="55" x="379" width="116" textAlign="right" text="Phone"/>
	<c:TextInput y="50" x="515" id="phone" width="190" text="{account.phone}"/>
	<mx:Label y="90" x="379" width="116" textAlign="right" text="Fax"/>
	<c:TextInput y="85" x="515" id="fax" width="190" text="{account.fax}"/>
	<mx:Label y="125" x="379" width="116" textAlign="right" text="Website"/>
	<c:TextInput y="120" x="515" id="url" width="190" text="{account.url}"/>
	<mx:Label y="160" x="379" width="116" textAlign="right" text="Email"/>
	<c:TextInput y="155" x="515" id="email" width="50" text="{account.email}"/>
	<mx:Label y="195" x="379" width="116" textAlign="right" text="Ownership"/>
	<c:TextInput y="190" x="515" id="ownership" width="190" text="{account.ownership}"/>

	<mx:Label x="10" y="241" text="Address Information" styleName="title"/>

	<mx:Label x="18" y="280" textAlign="right" width="116" text="Main Address"/>
	<c:TextInput x="154" y="275" id="address1" width="316" text="{account.address1}"/>
	<c:TextInput x="154" y="310" id="address2" width="316"  text="{account.address2}"/>
	<c:TextInput x="340" y="345" id="city" width="130" text="{account.city}"/>
	<c:ComboBox x="212" y="345" id="addressState" width="120" value="{account.state}" />
	<c:TextInput x="154" y="345" id="zip" width="50" text="{account.zip}"/>

	<mx:Label x="10" y="397" text="Customer Tracking" styleName="title"/>

	<mx:Label x="18" y="436" width="116" textAlign="right" text="Number Employees"/>
	<c:TextInput x="154" y="431" id="numEmployees" width="100" text="{account.numberEmployees}"/>
	<mx:Label x="18" y="471" width="116" textAlign="right" text="Annual Revenue"/>
	<c:TextInput x="154" y="466" id="revenue" width="100" text="{account.annualRevenue}"/>

	<mx:Label x="379" y="436" width="116" textAlign="right" text="Priority"/>
	<r:Ratings x="515" y="436" id="priority" horizontalGap="5"
	 	tooltips="['Very Low','Low','Medium','High','Very High']"
		value="{account.priority}" width="300" height="16"
		paddingTop="1"
		points="5"
		innerRadius="25"
		outerRadius="8"
		angle="90"/>
	<mx:Label x="379" y="471" width="116" textAlign="right" text="Rating"/>
	<r:Ratings x="515" y="472" id="rating" horizontalGap="5"
	 	tooltips="['Very Low','Low','Medium','High','Very High']"
		value="{account.rating}" width="300" height="16"
		paddingTop="1"
		points="5"
		innerRadius="25"
		outerRadius="8"
		angle="90"/>
	
	<mx:Button label="Save" bottom="10" left="10" click="save()"/>
	<mx:Button label="Save and Close" bottom="10" left="66" click="save(true)"/>
	
</mx:Canvas>